{% load static %}
<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="theme-color" content="#d4a574">
    <link rel="profile" href="//gmpg.org/xfn/11">
    <title>{% block title %}Bohu - Wedding & Wedding Planner WordPress Theme{% endblock %}</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Themify Icons (for Bohu theme) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/themify-icons@1.0.1/css/themify-icons.css">
    
    <!-- AOS Animation CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
    
    <!-- Animate.css (for WOW.js animations) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Main CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    
    {% block extra_css %}{% endblock %}
</head>

<body id="top" class="{% block body_class %}{% endblock %}">
    
    <!-- PRELOADER -->
    {% include 'includes/preloader.html' %}
    
    <!-- PAGE WRAPPER -->
    <div class="page-wrapper">
        
        <!-- HEADER -->
        {% include 'includes/header.html' %}
        
        <!-- SEARCH FORM (Outside header for :target to work) -->
        <div id="search-form" class="search-form" style="display: none;">
            <form method="get" action="{% url 'search' %}" class="search-form-inner">
                <div class="input-group">
                    <input type="search" name="q" class="form-control" placeholder="Search here..." required>
                    <button type="submit" class="btn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <a href="#" class="close-search d-block mt-2 text-center">
                    <small>Close</small>
                </a>
            </form>
        </div>
        
        <!-- MAIN CONTENT -->
        <main>
            {% block content %}{% endblock %}
        </main>
        
        <!-- FOOTER -->
        {% include 'includes/footer.html' %}
        
    </div><!-- End page-wrapper -->
    
    <!-- BACK TO TOP BUTTON -->
    <a href="#top" class="back-to-top" id="back-to-top">
        <i class="fas fa-chevron-up"></i>
    </a>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- MINIMAL JAVASCRIPT -->
    <script>
        // Wait for DOM to load
        document.addEventListener('DOMContentLoaded', function() {
            
            // Add loaded class for JS-dependent elements
            document.body.classList.add('js-loaded');
            
            // Hide preloader when page loads
            window.addEventListener('load', function() {
                setTimeout(function() {
                    const preloader = document.querySelector('.preloader');
                    if (preloader) {
                        preloader.classList.add('loaded');
                        setTimeout(() => {
                            preloader.style.display = 'none';
                        }, 500);
                    }
                }, 500);
            });
            
            // Update copyright year automatically
            document.querySelectorAll('.current-year').forEach(el => {
                el.textContent = new Date().getFullYear();
            });
            
            // ============================================
            // Mobile Navigation
            // ============================================
            
            // Mobile menu toggle
            const navbarToggler = document.querySelector('.navbar-toggler.open-btn');
            const navbarCollapse = document.querySelector('.site-navbar.collapse.navbar-collapse.navigation-holder');
            const menuClose = document.querySelector('.menu-close');
            
            if (navbarToggler && navbarCollapse) {
                navbarToggler.addEventListener('click', function() {
                    navbarCollapse.classList.toggle('show');
                });
                
                if (menuClose) {
                    menuClose.addEventListener('click', function() {
                        navbarCollapse.classList.remove('show');
                    });
                }
                
                // Close menu when clicking outside
                document.addEventListener('click', function(event) {
                    const isClickInside = navbarToggler.contains(event.target) || 
                                          navbarCollapse.contains(event.target) ||
                                          (menuClose && menuClose.contains(event.target));
                    if (!isClickInside && navbarCollapse.classList.contains('show')) {
                        navbarCollapse.classList.remove('show');
                    }
                });
            }
            
            // Mobile dropdown toggle for menu
            const mobileDropdownToggles = document.querySelectorAll('.menu-item-has-children > a');
            
            mobileDropdownToggles.forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    if (window.innerWidth <= 991) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const parent = this.parentElement;
                        const isActive = parent.classList.contains('active');
                        
                        // Close other dropdowns
                        document.querySelectorAll('.menu-item-has-children.active').forEach(item => {
                            if (item !== parent) {
                                item.classList.remove('active');
                            }
                        });
                        
                        // Toggle current dropdown
                        parent.classList.toggle('active');
                    }
                });
            });
            
            // Add active class to current page
            const currentPath = window.location.pathname;
            document.querySelectorAll('.menu-item > a').forEach(link => {
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                    // Mark parent dropdown as active
                    const parentMenuItem = link.closest('.menu-item');
                    if (parentMenuItem) {
                        parentMenuItem.classList.add('active');
                    }
                }
            });
            
            // ============================================
            // Sticky Header & Back to Top
            // ============================================
            
            // Sticky header
            const wpoHeader = document.querySelector('.wpo-custom-site-header.wpo-site-header.wpo-header-style-1');
            
            if (wpoHeader) {
                window.addEventListener('scroll', function() {
                    if (window.scrollY > 100) {
                        wpoHeader.classList.add('sticky');
                    } else {
                        wpoHeader.classList.remove('sticky');
                    }
                });
            }
            
            // Back to top button
            const backToTop = document.getElementById('back-to-top');
            if (backToTop) {
                window.addEventListener('scroll', function() {
                    if (window.scrollY > 300) {
                        backToTop.style.opacity = '1';
                        backToTop.style.visibility = 'visible';
                    } else {
                        backToTop.style.opacity = '0';
                        backToTop.style.visibility = 'hidden';
                    }
                });
                
                backToTop.addEventListener('click', function(e) {
                    e.preventDefault();
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                });
            }
            
            // ============================================
            // Search Form Handling - FIXED VERSION
            // ============================================
            
            const searchToggleBtn = document.querySelector('.search-toggle-btn');
            const searchForm = document.getElementById('search-form');
            const closeSearch = document.querySelector('.close-search');
            
            if (searchToggleBtn && searchForm) {
                searchToggleBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Toggle search form visibility
                    if (searchForm.style.display === 'flex' || searchForm.classList.contains('active')) {
                        searchForm.style.display = 'none';
                        searchForm.classList.remove('active');
                    } else {
                        searchForm.style.display = 'flex';
                        searchForm.classList.add('active');
                        
                        // Focus on search input
                        setTimeout(() => {
                            const searchInput = searchForm.querySelector('input[type="search"]');
                            if (searchInput) {
                                searchInput.focus();
                            }
                        }, 100);
                    }
                });
                
                // Close search when clicking close button
                if (closeSearch) {
                    closeSearch.addEventListener('click', function(e) {
                        e.preventDefault();
                        searchForm.style.display = 'none';
                        searchForm.classList.remove('active');
                    });
                }
                
                // Close search when clicking outside
                document.addEventListener('click', function(e) {
                    if (searchForm.style.display === 'flex' || searchForm.classList.contains('active')) {
                        if (!searchForm.contains(e.target) && !searchToggleBtn.contains(e.target)) {
                            searchForm.style.display = 'none';
                            searchForm.classList.remove('active');
                        }
                    }
                });
                
                // Close search with Escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape') {
                        if (searchForm.style.display === 'flex' || searchForm.classList.contains('active')) {
                            searchForm.style.display = 'none';
                            searchForm.classList.remove('active');
                        }
                    }
                });
            }
            
            // ============================================
            // Shopping Cart Handling
            // ============================================
            
            // Cart toggle
            const cartToggle = document.querySelector('.cart-toggle-btn');
            const cartOverlay = document.querySelector('.mini-cart-content');
            const cartClose = document.querySelector('.mini-cart-close');
            
            if (cartToggle && cartOverlay) {
                cartToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    cartOverlay.classList.toggle('mini-cart-content-toggle');
                });
                
                if (cartClose) {
                    cartClose.addEventListener('click', function(e) {
                        e.preventDefault();
                        cartOverlay.classList.remove('mini-cart-content-toggle');
                    });
                }
                
                // Close cart when clicking outside
                document.addEventListener('click', function(e) {
                    if (cartOverlay.classList.contains('mini-cart-content-toggle')) {
                        if (!cartOverlay.contains(e.target) && !cartToggle.contains(e.target)) {
                            cartOverlay.classList.remove('mini-cart-content-toggle');
                        }
                    }
                });
                
                // Close cart with Escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && cartOverlay.classList.contains('mini-cart-content-toggle')) {
                        cartOverlay.classList.remove('mini-cart-content-toggle');
                    }
                });
            }
            
            // ============================================
            // Smooth Scrolling for anchor links
            // ============================================
            
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    const href = this.getAttribute('href');
                    
                    // Don't smooth scroll for #search-form
                    if (href === '#search-form') return;
                    
                    // Don't smooth scroll for #top (handled by back-to-top)
                    if (href === '#top') return;
                    
                    e.preventDefault();
                    const targetElement = document.querySelector(href);
                    if (targetElement) {
                        // Close mobile menu if open
                        if (navbarCollapse && navbarCollapse.classList.contains('show')) {
                            navbarCollapse.classList.remove('show');
                        }
                        
                        window.scrollTo({
                            top: targetElement.offsetTop - 100,
                            behavior: 'smooth'
                        });
                    }
                });
            });
            
        });
    </script>
    
    <!-- Include additional scripts -->
    {% include 'includes/scripts.html' %}
    
    {% block extra_js %}{% endblock %}
    
</body>
</html>